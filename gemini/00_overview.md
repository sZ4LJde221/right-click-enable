# 00. プロジェクト概要と仕組み

このドキュメントでは、**「JS Right-Click Enabler」** というChrome拡張機能がどのように動いているか、初心者向けに全体の仕組みを解説します。

## この拡張機能の目的
Webページによっては、右クリックメニュー（コンテキストメニュー）や、テキストのコピー、選択が禁止されていることがあります。この拡張機能は、そういった**「禁止機能」をJavaScriptを使って強制的に無効化（＝右クリックなどをできるようにする）」**ためのものです。

## 全体の仕組み（アーキテクチャ）

Chrome拡張機能は、いくつかの異なる役割を持ったファイルが連携して動きます。このプロジェクトでは、役割を明確に分けています。

```mermaid
graph TD
    User[ユーザー] -->|操作| Popup[Popup (popup/)]
    Web[Webページ] -->|読み込み| Content[Content Script (content.js)]
    
    Popup -->|指令| Background[Background (background.js)]
    Content -->|問い合わせ| Background
    
    Background -->|設定保存・読込| Storage[Chrome Storage]
    Background -->|スクリプト注入| Main[Main World Script (inject/main.js)]
    
    Main -->|制限解除| WebPage[Webページの実体]
```

### 登場人物（ファイル）とその役割

| ファイルの場所 | 役割名 | 何をする人？ | 
| :--- | :--- | :--- |
| `manifest.json` | 設計図 | 拡張機能の名前や権限、どのファイルを使うかを宣言する設定ファイル。 |
| `inject/main.js` | **実行犯** | 実際にWebページの中で暴れて、右クリック禁止などを解除するスクリプト。**一番重要**。 |
| `background.js` | 司令塔 | 常に裏で待機していて、PopupやContent Scriptからの連絡を受け、`inject/main.js` をページに送り込む役割。 |
| `content.js` | 偵察兵 | Webページが開かれたときに最初に動き、「ここは有効化対象のドメインかな？」と司令塔に聞く役割。 |
| `popup/` | リモコン | 拡張機能のアイコンをクリックしたときに出る画面。手動で有効化スイッチを押す場所。 |
| `options/` | 設定画面 | 有効化したドメインの一覧管理や削除をする画面。 |

## データの流れ

### 1. 手動で有効化する場合
1. あなたが拡張機能のアイコンをクリック（Popupが開く）。
2. 「有効化」ボタンを押す。
3. PopupからBackground（司令塔）へ「このタブで実行して！」とメッセージを送る。
4. Backgroundが `inject/main.js` をそのページに注入（実行）する。
5. `inject/main.js` が右クリック禁止を解除する。

### 2. 自動で有効化する場合（一度有効化したドメイン）
1. あなたがWebページを開く。
2. `content.js`（偵察兵）が動き出し、ドメイン（URL）を取得。
3. Backgroundに「このドメインは有効化リストに入ってる？」と聞く。
4. 入っていれば、Backgroundが `inject/main.js` を注入する。

## 初心者が学ぶべきポイント
- **責務の分離**: 「全部一つのファイルに書く」のではなく、「画面担当」「裏方担当」「実行担当」と分けることで、コードが管理しやすくなります。
- **メッセージパッシング**: 異なる役割のファイル同士（例：PopupとBackground）は直接変数をいじれません。`sendMessage` という仕組みで手紙のやり取りをして連携します。
- **Main World への注入**: 通常のChrome拡張機能のスクリプトは、Webページの元のJavaScriptとは隔離された世界（Isolated World）で動きますが、今回はWebページのJS（`addEventListener`など）を上書きする必要があるため、あえて **Main World** という「Webページと同じ世界」にスクリプトを送り込んでいます。これがこの拡張機能の技術的なキモです。
